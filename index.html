<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>金錢眼球珍珠奶茶</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Microsoft YaHei', '微軟正黑體', sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            min-width: 280px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        
        input[type="number"] {
            width: 120px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus {
            border-color: #ffd700;
            outline: none;
        }
        
        button {
            padding: 15px 25px;
            margin: 8px 0;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        #addMoney {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
        }
        
        #addMoney:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        #reset {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }
        
        #reset:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .stats {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .stat-item {
            margin: 12px 0;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-value {
            color: #e74c3c;
            font-weight: bold;
            font-size: 18px;
        }
        
        .conversion-info {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin: 15px 0;
            padding: 12px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .bubble-tea-display {
            background: linear-gradient(45deg, #8B4513, #D2691E);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            margin: 15px 0;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
        }
        
        .pearl-progress {
            margin: 15px 0;
            padding: 12px;
            background: rgba(47, 79, 79, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(47, 79, 79, 0.3);
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #2F4F4F, #4682B4);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.3) 50%, transparent 75%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="ui">
            <div class="title">💰👁️🧋 金錢眼球轉換器</div>
            
            <div class="control-group">
                <label>1. 投入美元金額：</label>
                <input type="number" id="usdAmount" value="1" min="0.01" step="0.01">
            </div>
            
            <button id="addMoney">💰 1. 投入美元 ($1 USD)</button>
            <button id="reset">🔄 錢歸零</button>
            
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">總美元：</span>
                    <span class="stat-value">$<span id="totalUSD">0</span></span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">總台幣：</span>
                    <span class="stat-value">NT$<span id="totalNT">0</span></span>
                </div>
                
                <div class="bubble-tea-display">
                    🧋 珍奶杯數：<span id="teaCount">0</span> 杯
                </div>
                
                <div class="pearl-progress">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span style="font-size: 14px; font-weight: bold;">珍珠進度</span>
                        <span style="font-size: 14px;"><span id="currentPearls">0</span>/80 顆</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div style="font-size: 12px; color: #666; text-align: center; margin-top: 5px;">
                        距離下一杯還需：NT$<span id="nextTeaNeeded">55</span>
                    </div>
                </div>
                
                <div class="stat-item">
                    <span class="stat-label">地上珍珠：</span>
                    <span class="stat-value"><span id="groundPearls">0</span> 顆</span>
                </div>
                
                <div class="conversion-info">
                    💱 匯率：1 USD = 31 TWD<br>
                    🧋 每 55 台幣 = 1 杯珍奶 (80顆珍珠)<br>
                    🔵 錢通過眼球後變珍珠散落
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全域變數
        let scene, camera, renderer;
        let eye, coins = [], groundPearls = [], bubbleTeaCups = [];
        let totalUSD = 0;
        let totalNT = 0;
        let teaCount = 0;
        let groundPearlCount = 0;
        const USD_TO_NT = 31;
        const NT_PER_TEA = 55;
        const PEARLS_PER_TEA = 80;
        
        // 初始化場景
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // 進階燈光設定
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.2);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0xffd700, 0.8, 100);
            pointLight.position.set(0, 5, 5);
            scene.add(pointLight);
            
            // 創建地面
            createGround();
            
            // 創建眼球
            createRealisticEye();
            
            // 相機位置
            camera.position.set(0, 3, 12);
            camera.lookAt(0, 0, 0);
            
            // 事件監聽器
            document.getElementById('addMoney').addEventListener('click', addMoney);
            document.getElementById('reset').addEventListener('click', resetAll);
            document.getElementById('usdAmount').addEventListener('change', updateButtonText);
            
            animate();
        }
        
        function createGround() {
            const groundGeometry = new THREE.PlaneGeometry(30, 30);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x8FBC8F,
                transparent: true,
                opacity: 0.7
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -5;
            ground.receiveShadow = true;
            scene.add(ground);
        }
        
        function createRealisticEye() {
            const eyeGroup = new THREE.Group();
            
            // 主眼球 - 更大更真實
            const eyeGeometry = new THREE.SphereGeometry(2, 64, 64);
            const eyeMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffffff,
                shininess: 100,
                specular: 0x111111
            });
            const eyeball = new THREE.Mesh(eyeGeometry, eyeMaterial);
            eyeball.castShadow = true;
            eyeGroup.add(eyeball);
            
            // 虹膜 - 更細緻
            const irisGeometry = new THREE.SphereGeometry(1.2, 32, 32);
            const irisMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x4a90e2,
                shininess: 80
            });
            const iris = new THREE.Mesh(irisGeometry, irisMaterial);
            iris.position.z = 1.8;
            eyeGroup.add(iris);
            
            // 瞳孔 - 深邃黑色
            const pupilGeometry = new THREE.SphereGeometry(0.6, 32, 32);
            const pupilMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x000000,
                shininess: 200
            });
            const pupil = new THREE.Mesh(pupilGeometry, pupilMaterial);
            pupil.position.z = 1.85;
            eyeGroup.add(pupil);
            
            // 眼瞼
            const eyelidGeometry = new THREE.RingGeometry(1.8, 2.8, 32, 1, 0, Math.PI);
            const eyelidMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffdbac, 
                side: THREE.DoubleSide,
                shininess: 30
            });
            
            const upperEyelid = new THREE.Mesh(eyelidGeometry, eyelidMaterial);
            upperEyelid.position.z = 1.9;
            upperEyelid.rotation.z = Math.PI;
            eyeGroup.add(upperEyelid);
            
            const lowerEyelid = new THREE.Mesh(eyelidGeometry, eyelidMaterial);
            lowerEyelid.position.z = 1.9;
            eyeGroup.add(lowerEyelid);
            
            eyeGroup.position.set(0, 2, 0);
            scene.add(eyeGroup);
            eye = eyeGroup;
        }
        
        function createRealisticCoin(value) {
            const coinGroup = new THREE.Group();
            
            // 硬幣主體 - 更厚實
            const coinGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.15, 32);
            const coinMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffd700,
                shininess: 100,
                specular: 0x333333
            });
            const coin = new THREE.Mesh(coinGeometry, coinMaterial);
            coin.castShadow = true;
            coinGroup.add(coin);
            
            // 硬幣邊緣
            const edgeGeometry = new THREE.CylinderGeometry(0.41, 0.41, 0.14, 32);
            const edgeMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xb8860b,
                shininess: 80
            });
            const edge = new THREE.Mesh(edgeGeometry, edgeMaterial);
            coinGroup.add(edge);
            
            // 美元符號浮雕
            const dollarGeometry = new THREE.RingGeometry(0.15, 0.25, 16);
            const dollarMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x8b7355,
                shininess: 50
            });
            const dollarSign = new THREE.Mesh(dollarGeometry, dollarMaterial);
            dollarSign.position.z = 0.08;
            coinGroup.add(dollarSign);
            
            // 隨機位置從上方掉落
            coinGroup.position.set(
                (Math.random() - 0.5) * 8,
                8,
                (Math.random() - 0.5) * 4
            );
            
            coinGroup.userData = {
                value: value,
                velocity: new THREE.Vector3(0, -0.08, 0),
                rotationSpeed: new THREE.Vector3(
                    Math.random() * 0.15,
                    Math.random() * 0.15,
                    Math.random() * 0.15
                ),
                stage: 'falling'
            };
            
            scene.add(coinGroup);
            coins.push(coinGroup);
        }
        
        function createRealisticPearl(startPos) {
            const pearlGeometry = new THREE.SphereGeometry(0.12, 16, 16);
            const pearlMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x2F4F4F,
                shininess: 120,
                specular: 0x444444
            });
            const pearl = new THREE.Mesh(pearlGeometry, pearlMaterial);
            pearl.castShadow = true;
            pearl.receiveShadow = true;
            
            pearl.position.copy(startPos);
            
            pearl.userData = {
                velocity: new THREE.Vector3(
                    (Math.random() - 0.5) * 0.3,
                    Math.random() * 0.1,
                    (Math.random() - 0.5) * 0.3
                ),
                rotationSpeed: new THREE.Vector3(
                    Math.random() * 0.2,
                    Math.random() * 0.2,
                    Math.random() * 0.2
                ),
                bounces: 0,
                isGrounded: false
            };
            
            scene.add(pearl);
            groundPearls.push(pearl);
        }
        
        function createBubbleTeaCup() {
            const cupGroup = new THREE.Group();
            
            // 杯子主體
            const cupGeometry = new THREE.CylinderGeometry(0.8, 0.6, 2, 32);
            const cupMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x8B4513,
                shininess: 60
            });
            const cup = new THREE.Mesh(cupGeometry, cupMaterial);
            cup.castShadow = true;
            cupGroup.add(cup);
            
            // 奶茶液體
            const liquidGeometry = new THREE.CylinderGeometry(0.75, 0.55, 1.6, 32);
            const liquidMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xD2691E,
                shininess: 40,
                transparent: true,
                opacity: 0.9
            });
            const liquid = new THREE.Mesh(liquidGeometry, liquidMaterial);
            liquid.position.y = 0.2;
            cupGroup.add(liquid);
            
            // 杯子裡的珍珠
            for (let i = 0; i < PEARLS_PER_TEA; i++) {
                const pearlGeometry = new THREE.SphereGeometry(0.06, 12, 12);
                const pearlMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0x2F4F4F,
                    shininess: 100
                });
                const pearl = new THREE.Mesh(pearlGeometry, pearlMaterial);
                pearl.position.set(
                    (Math.random() - 0.5) * 1.2,
                    -0.6 + Math.random() * 1.2,
                    (Math.random() - 0.5) * 1.2
                );
                cupGroup.add(pearl);
            }
            
            // 吸管
            const strawGeometry = new THREE.CylinderGeometry(0.04, 0.04, 2.5, 16);
            const strawMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xFF69B4,
                shininess: 80
            });
            const straw = new THREE.Mesh(strawGeometry, strawMaterial);
            straw.position.set(0.4, 0.7, 0);
            cupGroup.add(straw);
            
            // 杯蓋
            const lidGeometry = new THREE.CylinderGeometry(0.82, 0.82, 0.1, 32);
            const lidMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xffffff,
                shininess: 60
            });
            const lid = new THREE.Mesh(lidGeometry, lidMaterial);
            lid.position.y = 1.05;
            cupGroup.add(lid);
            
            // 隨機位置在螢幕右側顯示
            cupGroup.position.set(
                6 + Math.random() * 4,
                -2,
                (Math.random() - 0.5) * 6
            );
            
            scene.add(cupGroup);
            bubbleTeaCups.push(cupGroup);
        }
        
        function addMoney() {
            const usdValue = parseFloat(document.getElementById('usdAmount').value);
            createRealisticCoin(usdValue);
        }
        
        function resetAll() {
            // 清除所有物件
            coins.forEach(coin => scene.remove(coin));
            coins = [];
            
            groundPearls.forEach(pearl => scene.remove(pearl));
            groundPearls = [];
            
            bubbleTeaCups.forEach(cup => scene.remove(cup));
            bubbleTeaCups = [];
            
            // 重置數值
            totalUSD = 0;
            totalNT = 0;
            teaCount = 0;
            groundPearlCount = 0;
            
            updateUI();
        }
        
        function updateButtonText() {
            const usdValue = parseFloat(document.getElementById('usdAmount').value);
            document.getElementById('addMoney').textContent = `💰 1. 投入美元 ($${usdValue} USD)`;
        }
        
        function updateUI() {
            document.getElementById('totalUSD').textContent = totalUSD.toFixed(2);
            document.getElementById('totalNT').textContent = Math.floor(totalNT);
            document.getElementById('teaCount').textContent = teaCount;
            document.getElementById('groundPearls').textContent = groundPearlCount;
            
            // 計算當前珍珠進度
            const remainingNT = Math.floor(totalNT) % NT_PER_TEA;
            const currentPearls = Math.floor((remainingNT / NT_PER_TEA) * PEARLS_PER_TEA);
            const progressPercent = (remainingNT / NT_PER_TEA) * 100;
            
            document.getElementById('currentPearls').textContent = currentPearls;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('nextTeaNeeded').textContent = NT_PER_TEA - remainingNT;
        }
        
        function processCoinThroughEye(coinValue) {
            totalUSD += coinValue;
            const addedNT = coinValue * USD_TO_NT;
            const previousNT = totalNT;
            totalNT += addedNT;
            
            // 計算新增的珍珠數量 (每1台幣產生約1.45顆珍珠)
            const pearlsToCreate = Math.floor(addedNT * 1.45);
            
            // 批次創建珍珠
            for (let i = 0; i < pearlsToCreate; i++) {
                setTimeout(() => {
                    const eyePos = new THREE.Vector3(0, 2, 0);
                    createRealisticPearl(eyePos);
                    groundPearlCount++;
                }, i * 50);
            }
            
            // 檢查是否達到新的珍奶杯數
            const newTeaCount = Math.floor(totalNT / NT_PER_TEA);
            if (newTeaCount > teaCount) {
                const cupsToCreate = newTeaCount - teaCount;
                for (let i = 0; i < cupsToCreate; i++) {
                    setTimeout(() => {
                        createBubbleTeaCup();
                        teaCount++;
                        updateUI();
                    }, (pearlsToCreate * 50) + (i * 800));
                }
            }
            
            updateUI();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // 更新硬幣
            for (let i = coins.length - 1; i >= 0; i--) {
                const coin = coins[i];
                const userData = coin.userData;
                
                if (userData.stage === 'falling') {
                    coin.position.add(userData.velocity);
                    coin.rotation.x += userData.rotationSpeed.x;
                    coin.rotation.y += userData.rotationSpeed.y;
                    coin.rotation.z += userData.rotationSpeed.z;
                    
                    // 重力加速
                    userData.velocity.y -= 0.003;
                    
                    // 檢查是否接近眼球
                    if (coin.position.y <= 3.5) {
                        userData.stage = 'attracted';
                        const eyeCenter = new THREE.Vector3(0, 2, 0);
                        const direction = eyeCenter.clone().sub(coin.position).normalize();
                        userData.velocity = direction.multiplyScalar(0.15);
                    }
                }
                else if (userData.stage === 'attracted') {
                    coin.position.add(userData.velocity);
                    coin.rotation.x += userData.rotationSpeed.x;
                    coin.rotation.y += userData.rotationSpeed.y;
                    coin.rotation.z += userData.rotationSpeed.z;
                    
                    const distanceToEye = coin.position.distanceTo(new THREE.Vector3(0, 2, 0));
                    if (distanceToEye < 0.8) {
                        processCoinThroughEye(userData.value);
                        scene.remove(coin);
                        coins.splice(i, 1);
                    }
                }
            }
            
            // 更新地上珍珠
            groundPearls.forEach(pearl => {
                const userData = pearl.userData;
                
                if (!userData.isGrounded) {
                    pearl.position.add(userData.velocity);
                    pearl.rotation.x += userData.rotationSpeed.x;
                    pearl.rotation.y += userData.rotationSpeed.y;
                    pearl.rotation.z += userData.rotationSpeed.z;
                    
                    // 重力
                    userData.velocity.y -= 0.008;
                    
                    // 地面碰撞
                    if (pearl.position.y <= -4.7 && userData.bounces < 3) {
                        userData.velocity.y = Math.abs(userData.velocity.y) * 0.4;
                        userData.velocity.x *= 0.8;
                        userData.velocity.z *= 0.8;
                        userData.bounces++;
                        
                        if (userData.bounces >= 3 || Math.abs(userData.velocity.y) < 0.01) {
                            userData.isGrounded = true;
                            pearl.position.y = -4.7;
                            userData.velocity.set(0, 0, 0);
                        }
                    }
                }
            });
            
            // 眼球動畫
            if (eye) {
                eye.rotation.y += 0.008;
                eye.position.y = 2 + Math.sin(Date.now() * 0.001) * 0.1;
            }
            
            // 珍奶杯動畫
            bubbleTeaCups.forEach((cup, index) => {
                cup.position.y = -2 + Math.sin(Date.now() * 0.002 + index) * 0.15;
                cup.rotation.y += 0.003;
            });
            
            renderer.render(scene, camera);
        }
        
        // 視窗調整
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        init();
    </script>
</body>
</html>